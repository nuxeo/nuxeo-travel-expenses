<dom-module id="nx-task">

  <link rel="import" type="css" href="nx-task.css">

  <template>

    <!-- task resource -->
    <nx-resource id="task" path="[[actionPath(task, action)]]" data="{{task}}" headers='"{\"Content-Type\": \"application/json\"}"'></nx-resource>

    <div>

      <content></content>

      <paper-icon-item class="field actors">
        <iron-icon icon="group-work" title="[[i18n('wf.actors')]]" item-icon></iron-icon>
        <ul>
          <template is="dom-repeat" items="[[task.actors]]" as="actor">
            <li>[[actor.id]]</li>
          </template>
        </ul>
      </paper-icon-item>

      <paper-icon-item class="field dueData">
        <iron-icon icon="alarm" title="[[i18n('wf.dueDate')]]" item-icon></iron-icon>
        <span>[[formatDate(task.dueDate)]]</span>
      </paper-icon-item>

      <paper-icon-item class="field directive">
        <iron-icon icon="flag" title="[[i18n('wf.directive')]]" item-icon></iron-icon>
        <span>[[i18n(task.directive)]]</span>
      </paper-icon-item>

    </div>

    <paper-toolbar>
      <template is="dom-repeat" items="[[task.taskInfo.taskActions]]" as="action">
        <paper-button on-tap="callAction" raised>[[i18n(action.label)]]</paper-button>
      </template>
    </paper-toolbar>

    <paper-toast id="errorMessage" text="Failed to invoke [[action]]"></paper-toast>
  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'nx-task',

      properties: { task: { notify: true } },

      callAction: function (event) {
        this.action = event.model.action.name;
        this.$.task
          .put()
          .then(function (data) {
            this.fire('action', this.action);
          }.bind(this))
          .catch(function (error) {
            this.$.errorMessage.show();
          }.bind(this));
      },

      actionPath: function (task, action) {
        return (task) ? '/task/' + task.id + '/' + action : '';
      }
    });
  }());
</script>
